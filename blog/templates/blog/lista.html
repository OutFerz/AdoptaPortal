{% extends "base.html" %}
{% load static %}

{% block title %}Blog de cuidados y consejos{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/blog.css' %}?v={% now 'U' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'blog/js/blog.js' %}?v={% now 'U' %}" defer></script>
{% endblock %}

{% block content %}
<section class="blog-hero">
  <div class="blog-hero__icon" aria-hidden="true">
    <!-- Patita SVG: siempre visible -->
    <svg viewBox="0 0 48 48"><path fill="currentColor" d="M20.3 25.6c-2.6.5-4.6 2.7-4.6 5.3c0 3 2.4 5.4 5.4 5.4c1.6 0 3-.7 4-1.8c1 1.1 2.4 1.8 4 1.8c3 0 5.4-2.4 5.4-5.4c0-2.6-1.9-4.8-4.6-5.3c-2.4-.4-4.6-1.1-6.4-2.1c-1.8 1-4 1.7-6.4 2.1zM13.8 20.7a4.3 4.3 0 1 0 0-8.6a4.3 4.3 0 0 0 0 8.6zm20.4 0a4.3 4.3 0 1 0 0-8.6a4.3 4.3 0 0 0 0 8.6zM23.4 18a5 5 0 1 0 0-10a5 5 0 0 0 0 10zm1.2 0a5 5 0 1 0 0-10a5 5 0 0 0 0 10z"/></svg>
  </div>
  <h1 class="blog-hero__title">Blog de cuidados y consejos</h1>
  <p class="blog-hero__subtitle">Encuentra guías, tips y buenas prácticas para el bienestar de tus mascotas.</p>

  <form class="blog-search" method="get" action=".">
    <input class="blog-search__input" type="search" name="q" value="{{ request.GET.q|default_if_none:'' }}" placeholder="Buscar por título, tema o etiqueta…">
    <button class="btn btn--primary" type="submit">Buscar</button>
  </form>

  {% if categorias %}
  <div class="blog-cats">
    {% for c in categorias %}
      <a class="chip {% if request.GET.categoria == c.slug or request.GET.categoria == c.id|stringformat:'s' %}chip--active{% endif %}"
         href="?categoria={{ c.slug|default:c.id }}">{{ c.nombre|default:c }}</a>
    {% endfor %}
  </div>
  {% endif %}
</section>

{% if posts %}
  <section class="posts-grid">
    {% for p in posts %}
      <article class="post-card js-reveal">
        <a class="post-card__media" href="{{ p.get_absolute_url|default:('/blog/'|add:p.pk|stringformat:'s'|add:'/')}}">
          {% if p.imagen or p.cover or p.portada %}
            <img loading="lazy" src="{{ p.imagen.url|default:p.cover.url|default:p.portada.url }}" alt="{{ p.titulo|default:p.title }}">
          {% endif %}
        </a>

        <div class="post-card__body">
          <div class="post-card__meta">
            {% with cat=p.categoria|default:p.category %}
              {% if cat %}
                <a class="link-muted" href="?categoria={{ cat.slug|default:cat.id }}">{{ cat.nombre|default:cat }}</a>
                <span aria-hidden="true">•</span>
              {% endif %}
            {% endwith %}
            <time datetime="{{ p.fecha_publicacion|date:'c'|default:p.fecha|date:'c' }}">
              {{ p.fecha_publicacion|date:"d M Y"|default:p.fecha|date:"d M Y" }}
            </time>
            {% if p.autor or p.author %}
              <span aria-hidden="true">•</span>
              <span class="muted">por {{ p.autor|default:p.author }}</span>
            {% endif %}
          </div>

          <h2 class="post-card__title">
            <a href="{{ p.get_absolute_url|default:('/blog/'|add:p.pk|stringformat:'s'|add:'/')}}">
              {{ p.titulo|default:p.title }}
            </a>
          </h2>

          <p class="post-card__excerpt">
            {% firstof p.extracto p.resumen p.excerpt p.summary p.contenido|striptags|truncatewords:36 %}
          </p>

          {% if p.tags.all or p.tags or p.etiquetas %}
          <div class="post-card__tags">
            {% if p.tags.all %}
              {% for t in p.tags.all %}
                <a class="chip chip--ghost" href="?tag={{ t.slug|default:t }}">{{ t.name|default:t }}</a>
              {% endfor %}
            {% elif p.tags %}
              {% for t in p.tags %}
                <a class="chip chip--ghost" href="?tag={{ t.slug|default:t }}">{{ t.name|default:t }}</a>
              {% endfor %}
            {% elif p.etiquetas %}
              {% for t in p.etiquetas %}
                <a class="chip chip--ghost" href="?tag={{ t.slug|default:t }}">{{ t }}</a>
              {% endfor %}
            {% endif %}
          </div>
          {% endif %}
        </div>
      </article>
    {% endfor %}
  </section>
{% else %}
  <p class="empty">No se encontraron artículos para tu búsqueda.</p>
{% endif %}
{% endblock %}