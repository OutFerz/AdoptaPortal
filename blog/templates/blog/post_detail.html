{% extends "base.html" %}
{% load static %}
{% block title %}{{ post.title }} ‚Äî Blog{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'blog/css/blog.css' %}?v={% now 'U' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'blog/js/blog.js' %}?v={% now 'U' %}" defer></script>
{% endblock %}

{% block content %}
<div id="readProgress" class="read-progress" aria-hidden="true"></div>

<nav class="breadcrumbs">
  <a class="crumb" href="{% url 'blog:post_list' %}">‚Üê Volver al blog</a>
  {% if post.category %}
    <span class="crumb">/</span>
    <a class="crumb" href="{% url 'blog:post_list' %}?cat={{ post.category.slug }}">{{ post.category.name }}</a>
  {% endif %}
  <span class="crumb is-current">/ {{ post.title }}</span>
</nav>

<article class="post-detail">
  <header class="article-hero">
    <figure class="article-hero__media">
      {% if post.hero_image %}
        <img src="{{ post.hero_image.url }}" alt="Imagen de {{ post.title }}">
      {% else %}
        <img src="{% static 'blog/img/default-cat.svg' %}" alt="Imagen por defecto">
      {% endif %}
    </figure>
    <div class="article-hero__overlay" aria-hidden="true"></div>
    <div class="article-hero__content">
      <div class="post-meta post-meta--on-hero">
        {% if post.category %}<span class="chip">{{ post.category.name }}</span>{% endif %}
        {% if post.published_at %}<span class="chip">{{ post.published_at|date:"d M Y" }}</span>{% endif %}
        {% if post.author %}<span class="chip">por {{ post.author.username|default:post.author }}</span>{% endif %}
        <span class="chip" data-readtime>‚è±Ô∏è</span>
      </div>
      <h1 class="post-title">{{ post.title }}</h1>
      <div class="post-quick">
        <button class="btn btn--ghost" type="button" data-copy-link data-url="{{ request.build_absolute_uri }}">Copiar enlace</button>
        {% if post.tags.all %}
          <div class="post-card__tags">
            {% for t in post.tags.all %}
              <a class="chip chip--ghost" href="{% url 'blog:post_list' %}?tag={{ t.slug }}">#{{ t.name }}</a>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </header>

  <section id="postContent" class="prose">
    {{ post.content|safe }}
  </section>

  <footer class="post-footer">
    <hr class="sep">
    <div class="post-pager">
      <a class="pager" href="{% url 'blog:post_list' %}">‚Üê Ver m√°s publicaciones</a>
    </div>
  </footer>
</article>

<hr class="sep">

<section id="comments" class="comments">
  <h2 class="section-title">üí¨ Comentarios ({{ comments|length }})</h2>

  {% if messages %}
    <div class="flash">
      {% for message in messages %}
        <div class="flash__item {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  {% if comments %}
    <ul class="comment-list">
      {% for c in comments %}
        <li class="comment">
          <div class="comment__head">
            <span class="comment__author">{{ c.name }}</span>
            <span class="comment__date">‚Äî {{ c.created_at|date:"d M Y H:i" }}</span>
          </div>
          <div class="comment__body">{{ c.body|linebreaksbr }}</div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="muted">¬°S√© el primero en comentar!</p>
  {% endif %}

  <h3 class="section-subtitle">‚úçÔ∏è Deja tu comentario</h3>
  <form method="post" class="comment-form">
    {% csrf_token %}
    <div class="form-row">
      <div class="form-field">
        <label for="id_name">Nombre</label>
        {{ form.name }}
        {% if form.name.errors %}<div class="form-errors">{{ form.name.errors|striptags }}</div>{% endif %}
      </div>
      <div class="form-field">
        <label for="id_email">Email</label>
        {{ form.email }}
        {% if form.email.errors %}<div class="form-errors">{{ form.email.errors|striptags }}</div>{% endif %}
      </div>
    </div>
    <div class="form-field">
      <label for="id_body">Comentario</label>
      {{ form.body }}
      {% if form.body.errors %}<div class="form-errors">{{ form.body.errors|striptags }}</div>{% endif %}
    </div>
    <button class="btn btn--primary" type="submit">Publicar comentario</button>
  </form>
</section>
{% endblock %}