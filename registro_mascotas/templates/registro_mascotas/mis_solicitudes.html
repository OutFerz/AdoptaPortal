{% extends "base.html" %}
{% load static %}

{% block title %}Mis publicaciones{% endblock %}

{% block content %}
<style>
  .ms-card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:18px;margin:12px 0}
  .ms-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .ms-title{margin:0;font-size:1.4rem}
  .ms-table{width:100%;border-collapse:separate;border-spacing:0 8px}
  .ms-row{background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden}
  .ms-row td{padding:10px 12px;vertical-align:middle}
  .ms-badge{display:inline-block;padding:4px 8px;border-radius:999px;font-size:.85rem;font-weight:700}
  .ms-badge-pend{background:#fff7ed;color:#9a3412;border:1px solid #fdba74}
  .ms-badge-ok{background:#ecfdf5;color:#065f46;border:1px solid #34d399}
  .ms-badge-no{background:#fef2f2;color:#991b1b;border:1px solid #f87171}
  .ms-msg{color:#374151;font-size:.95rem}
  .ms-empty{color:#6b7280;text-align:center;margin:16px 0}
  .thumb{width:72px;height:72px;object-fit:cover;border-radius:10px;border:1px solid #e5e7eb;background:#fff}
  .pill{font-size:.85rem;color:#374151}
</style>

<section class="ms-card">
  <div class="ms-header">
    <h1 class="ms-title">Mis solicitudes de publicación</h1>
    <a href="{% url 'registro_mascotas:publicar_mascota' %}?modo=form" class="btn btn-primary">Nueva solicitud</a>
  </div>

  {% if solicitudes %}
    <table class="ms-table">
      <tbody>
        {% for s in solicitudes %}
          <tr class="ms-row">
            <td style="width:90px">
              {% if s.foto %}
                <img src="{{ s.foto.url }}" alt="{{ s.nombre }}" class="thumb">
              {% else %}
                <img src="{% static 'img/placeholder_pet.jpg' %}" alt="Mascota" class="thumb">
              {% endif %}
            </td>

            <td style="min-width:180px">
              <div style="font-weight:700">{{ s.nombre }}</div>
              <div class="pill">{{ s.get_tipo_display }} • {{ s.edad }} meses • {{ s.get_sexo_display }}</div>
              <div class="pill">{{ s.ubicacion }}</div>
            </td>

            <td style="width:160px;text-align:center">
              {% if s.estado == 'aprobada' %}
                <span class="ms-badge ms-badge-ok">Aprobada</span>
              {% elif s.estado == 'rechazada' %}
                <span class="ms-badge ms-badge-no">Rechazada</span>
              {% else %}
                <span class="ms-badge ms-badge-pend">Pendiente</span>
              {% endif %}
            </td>

            <td>
              {% if s.estado == 'aprobada' %}
                <div class="ms-msg">✅ Tu publicación fue aprobada y ya está visible.</div>
                {% if s.aceptacion_mensaje %}
                  <div class="pill">Mensaje: {{ s.aceptacion_mensaje }}</div>
                {% endif %}
              {% elif s.estado == 'rechazada' %}
                <div class="ms-msg">❌ Tu solicitud fue rechazada.</div>
                <div class="pill">Motivo: {{ s.rechazo_motivo|default:"—" }}</div>
                <div style="margin-top:8px">
                  <a href="{% url 'registro_mascotas:publicar_mascota' %}?modo=form&reintento={{ s.id }}" class="btn btn-secondary">Apelar / reenviar</a>
                </div>
              {% else %}
                <div class="ms-msg">⌛ En revisión por el equipo.</div>
              {% endif %}
            </td>

            <td style="width:160px;text-align:right;color:#6b7280">
              Enviada: {{ s.fecha_creacion|date:"d/m/Y H:i" }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="ms-empty">Aún no has enviado solicitudes.</p>
  {% endif %}
</section>
{% endblock %}