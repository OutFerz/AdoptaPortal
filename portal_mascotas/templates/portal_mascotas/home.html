{% extends "base.html" %}
{% load static %}

{% block title %}Adopciones disponibles{% endblock %}

{% block content %}

{% if messages %}
  <div id="flash" class="flash-messages" style="margin:12px 0;">
    {% for message in messages %}
      <div class="alert {{ message.tags }}" style="padding:10px 14px;border-radius:8px;margin-bottom:8px;
           {% if message.tags == 'success' %}background:#ecfdf5;color:#065f46;border:1px solid #34d399;
           {% elif message.tags == 'error' %}background:#fef2f2;color:#991b1b;border:1px solid #f87171;
           {% elif message.tags == 'info' %}background:#eff6ff;color:#1e3a8a;border:1px solid #60a5fa;
           {% else %}background:#f3f4f6;color:#111827;border:1px solid #e5e7eb;{% endif %}">
        üêæ {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

<style>
  .filters { display:grid; grid-template-columns:repeat(12,1fr); gap:12px; align-items:end; margin-bottom:18px; }
  .filters .field { grid-column: span 3; }
  .filters .actions { grid-column: span 12; display:flex; gap:10px; }
  @media (max-width:900px){ .filters .field{grid-column:span 6;} }
  @media (max-width:640px){ .filters .field,.filters .actions{grid-column:span 12;} }
  .filters label { display:block; font-size:.9rem; color:#374151; margin-bottom:6px; }
  .filters input,.filters select { width:100%; padding:10px 12px; border:1px solid #D1D5DB; border-radius:8px; background:#fff; }
  .btn { display:inline-block; padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
  .btn-primary { background:#4CAF50; color:#fff; }
  .btn-secondary { background:#E5E7EB; color:#111827; }
  .pet-grid { display:grid; grid-template-columns:repeat(12,1fr); gap:16px; }
  .pet-card { grid-column: span 3; background:#fff; border:1px solid #E5E7EB; border-radius:12px; overflow:hidden; display:flex; flex-direction:column; }
  @media (max-width:1200px){ .pet-card{grid-column:span 4;} }
  @media (max-width:900px){ .pet-card{grid-column:span 6;} }
  @media (max-width:640px){ .pet-card{grid-column:span 12;} }
  .pet-thumb { aspect-ratio:4/3; background:#f2f4f7; overflow:hidden; }
  .pet-thumb img { width:100%; height:100%; object-fit:cover; display:block; }
  .pet-body { padding:14px 16px 16px; display:flex; flex-direction:column; gap:8px; }
  .pet-name { margin:0; font-size:1.15rem; font-weight:700; color:#111827; }
  .pet-meta { margin:0; color:#6b7280; font-size:.95rem; }
  .pet-desc { margin:4px 0 0; color:#4b5563; font-size:.95rem; min-height:3.1em; }
  .pet-actions { margin-top:10px; display:flex; gap:8px; }
  .btn-outline { background:#fff; border:1px solid #D1D5DB; color:#111827; }
</style>

<div class="container">
  <h1 style="margin:0 0 14px; font-size:1.6rem;">Mascotas disponibles</h1>

  <form class="filters" method="get" action=".">
    <div class="field">
      <label for="tipo">Especie</label>
      <select id="tipo" name="tipo">
        <option value="">Todas</option>
        {% for key,label in tipos %}
          <option value="{{ key }}" {% if key == tipo %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="field">
      <label for="sexo">Sexo</label>
      <select id="sexo" name="sexo">
        <option value="">Todos</option>
        {% for key,label in sexos %}
          <option value="{{ key }}" {% if key == sexo %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="field">
      <label for="edad">Edad</label>
      <select id="edad" name="edad">
        <option value="">Cualquiera</option>
        {% for idx, rango in rangos_edad|enumerate %}
          <option value="{{ forloop.counter0 }}" {% if forloop.counter0|stringformat:'s' == edad %}selected{% endif %}>
            {{ rango.2 }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="field">
      <label for="ubic">Ubicaci√≥n</label>
      <input id="ubic" name="ubic" value="{{ ubic|default:'' }}" placeholder="Ciudad/Regi√≥n">
    </div>

    <div class="actions">
      <button class="btn btn-primary" type="submit">Filtrar</button>
      <a class="btn btn-secondary" href="{% url 'home' %}">Limpiar</a>
    </div>
  </form>

  {% if mascotas %}
    <div class="pet-grid">
      {% for m in mascotas %}
        <article class="pet-card">
          <div class="pet-thumb">
            {% if m.foto %}
              <img src="{{ m.foto.url }}" alt="{{ m.nombre }}">
            {% else %}
              <img src="{% static 'img/placeholder_pet.jpg' %}" alt="Mascota">
            {% endif %}
          </div>
          <div class="pet-body">
            <h3 class="pet-name">{{ m.nombre }}</h3>
            <p class="pet-meta">{{ m.get_tipo_display }} ‚Ä¢ {{ m.edad }} meses ‚Ä¢ {{ m.get_sexo_display }}</p>
            <p class="pet-desc">{{ m.descripcion|default:"Sin descripci√≥n" }}</p>
            <p class="pet-meta">Ubicaci√≥n: {{ m.ubicacion|default:"-" }}</p>

            {% if user.is_authenticated %}
              <form method="post" action="{% url 'solicitud_adopcion:crear_rapida' m.id %}" class="pet-actions">
                {% csrf_token %}
                <input type="hidden" name="mensaje" value="Quiero adoptar a {{ m.nombre }}">
                <button class="btn btn-primary" type="submit">Solicitar adopci√≥n</button>
                <a class="btn btn-outline" href="{% url 'solicitud_adopcion:lista_solicitudes' %}">Mis solicitudes</a>
              </form>
            {% else %}
              <div class="pet-actions">
                <a class="btn btn-primary" href="{% url 'login:login' %}?next={% url 'home' %}">Inicia sesi√≥n para solicitar</a>
              </div>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p style="text-align:center;color:#6b7280;">No hay mascotas que coincidan con tu b√∫squeda.</p>
  {% endif %}
</div>

{% endblock %}
